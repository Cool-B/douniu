<!--index.wxml-->
<view class="index-container">
  <!-- 背景动画元素 -->
  <view class="background-animations">
    <!-- 烟花效果 -->
    <view class="firework firework-1"></view>
    <view class="firework firework-2"></view>
    <view class="firework firework-3"></view>
    
    <!-- 浮动方块 -->
    <view class="floating-cube cube-1"></view>
    <view class="floating-cube cube-2"></view>
    <view class="floating-cube cube-3"></view>
    <view class="floating-cube cube-4"></view>
    
    <!-- 闪烁星星 -->
    <view class="twinkle-star star-1"></view>
    <view class="twinkle-star star-2"></view>
    <view class="twinkle-star star-3"></view>
    <view class="twinkle-star star-4"></view>
    <view class="twinkle-star star-5"></view>
    
    <!-- 扑克牌动画 -->
    <view class="floating-card card-1">♠</view>
    <view class="floating-card card-2">♥</view>
    <view class="floating-card card-3">♦</view>
    <view class="floating-card card-4">♣</view>
    <view class="floating-card card-5">A</view>
    <view class="floating-card card-6">K</view>
    <view class="floating-card card-7">Q</view>
    <view class="floating-card card-8">J</view>
  </view>

  <!-- 已登录状态 -->
  <view wx:if="{{loginFlag===1}}" class="home-page">
    <view class="user-welcome">
      <image class="user-avatar" src="{{currentUser.avatar}}" mode="aspectFill"></image>
      <text class="welcome-text">{{currentUser.name}}！</text>
    </view>

    <view class="game-section animate-fade-in">
      <view class="action-buttons">
        <button class="action-btn quick-start-btn" bindtap="quickStart" disabled="{{loading}}">
          <view class="btn-icon">⚡</view>
          <text class="btn-text">快速开始</text>
          <text class="btn-desc">创建新房间</text>
        </button>

        <button class="action-btn join-btn" bindtap="showModal" disabled="{{loading}}">
          <view class="btn-icon">🚪</view>
          <text class="btn-text">加入游戏</text>
          <text class="btn-desc">输入房间号</text>
        </button>

        <button class="action-btn rules-btn" bindtap="showRules">
          <view class="btn-icon">📖</view>
          <text class="btn-text">游戏规则</text>
          <text class="btn-desc">了解玩法</text>
        </button>

        <button class="action-btn mode-btn" bindtap="selectMode">
          <view class="btn-icon">👑</view>
          <text class="btn-text">游戏模式</text>
          <text class="btn-desc">敬请期待</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 未登录状态 -->
  <view wx:elif="{{loginFlag===2}}" class="login-page">
    <view class="login-header">
      <text class="login-title">斗牛扑克</text>
      <text class="login-subtitle">经典扑克游戏，体验刺激对决</text>
    </view>

    <view class="login-form animate-slide-up">
      <block wx:if="{{canIUseNicknameComp && !hasUserInfo}}">
        <view class="avatar-section">
          <text class="section-label">选择头像</text>
          <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
            <image class="avatar" src="{{userInfo.avatarUrl}}"></image>
            <view class="avatar-overlay">点击更换</view>
          </button>
        </view>

        <view class="nickname-section">
          <text class="section-label">设置昵称</text>
          <input type="nickname" class="nickname-input" placeholder="请输入您的游戏昵称" bind:change="onInputChange" />
        </view>

        <button class="login-submit-btn" bindtap="bindViewTap" disabled="{{loading}}">
          <text wx:if="{{!loading}}">开始游戏</text>
          <text wx:else class="loading-text">登录中...</text>
        </button>
      </block>

      <block wx:elif="{{!hasUserInfo}}">
        <view class="compatibility-warning">
          <text wx:if="{{canIUseGetUserProfile}}">请使用微信授权登录</text>
          <text wx:else>请使用2.10.4及以上版本基础库</text>
        </view>
      </block>
    </view>
  </view>

  <!-- 错误提示 -->
  <view wx:if="{{errorMsg}}" class="error-message animate-fade-in">
    <text>{{errorMsg}}</text>
  </view>

  <!-- 加载遮罩 -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-spinner"></view>
    <text class="loading-text">处理中...</text>
  </view>

  <!-- 规则弹窗组件 -->
  <rules-modal visible="{{showRulesModal}}" bind:close="onCloseRules"></rules-modal>

  <!-- 房间号弹窗组件 -->
  <room-modal visible="{{modalShow}}" title="房间号" showQuickStart="{{true}}" bind:close="onCloseModal" bind:cancel="onCancel" bind:confirm="onConfirm"></room-modal>
</view>