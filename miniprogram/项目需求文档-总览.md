# 斗牛扑克游戏微信小程序 - 完整需求文档

## 文档版本信息
- **版本号**: v1.0
- **创建日期**: 2025-12-29
- **文档用途**: 项目重构与新功能开发参考
- **技术栈**: TypeScript + WeChat MiniProgram + Glass-Easel

---

## 📋 文档目录

本需求文档分为以下独立文件,便于查阅和维护:

1. **项目需求文档-总览.md** (本文件)
2. **项目需求文档-业务需求.md** - 业务目标、用户画像、核心功能
3. **项目需求文档-功能需求.md** - 详细功能规格说明
4. **项目需求文档-技术架构.md** - 系统架构、技术选型、设计模式
5. **项目需求文档-数据模型.md** - 数据库设计、接口定义、状态管理
6. **项目需求文档-UI设计.md** - 界面设计规范、交互流程
7. **项目需求文档-开发计划.md** - 开发路线图、里程碑、风险评估

---

## 🎯 项目概述

### 项目简介
斗牛扑克游戏是一款基于微信小程序的多人在线卡牌游戏。玩家可以创建或加入房间,与其他玩家或AI机器人进行斗牛扑克对局。游戏支持庄家模式,包含下注、发牌、比牌、结算等完整游戏流程。

### 游戏类型
**斗牛(牛牛)** - 中国传统扑克牌游戏
- 每人5张牌
- 3张组合成10的倍数为"牛"
- 剩余2张相加个位数为牛点数
- 点数大者获胜

### 核心价值主张
1. **社交娱乐**: 支持多人在线对战,增加游戏趣味性
2. **简单易上手**: 规则简单,新手友好,配有详细规则说明
3. **灵活游戏模式**: 支持快速开始、房间号加入、AI填充等多种方式
4. **公平竞技**: 透明的牌型算法,公正的结算机制
5. **微信生态**: 深度集成微信登录、头像等功能

---

## 📊 项目现状分析

### 当前开发阶段
**阶段**: MVP原型阶段 (单机版 + Mock数据)

### 已实现功能 ✅
1. **用户系统**
   - 微信登录授权
   - 头像选择与昵称设置
   - 用户信息本地缓存

2. **房间系统**
   - 创建房间(快速开始)
   - 加入房间(房间号)
   - 房间信息展示
   - 退出房间

3. **游戏核心**
   - 洗牌算法(Fisher-Yates)
   - 发牌动画(300ms间隔)
   - 牌型识别算法(牛/无牛/炸弹/五小牛等)
   - 庄家与闲家角色分配
   - 下注系统(1-10倍)
   - 准备状态管理

4. **UI/UX**
   - 渐变色主题设计(紫色系)
   - 登录页动画效果(萤火虫粒子)
   - 房间模态框
   - 游戏规则模态框
   - 响应式布局(横屏优化)
   - 错误提示系统

5. **数据层**
   - Mock API实现
   - 本地存储管理
   - TypeScript类型定义
   - API路由层

### 待开发功能 ⚠️
1. **后端集成**
   - WebSocket实时通信(已预留代码)
   - 真实API对接
   - 用户认证系统
   - 房间同步机制

2. **游戏功能**
   - 完整结算流程
   - 积分/筹码系统
   - 游戏历史记录
   - 多轮游戏支持
   - 倒计时功能

3. **社交功能**
   - 好友系统
   - 聊天功能
   - 战绩排行榜
   - 分享功能

4. **优化改进**
   - 性能优化
   - 网络错误处理
   - 断线重连
   - 动画性能优化

---

## 🎮 核心游戏规则

### 基本规则
1. **玩家人数**: 2-5人(1庄家 + 1-4闲家)
2. **牌组**: 40张牌(4花色 × 1-10点)
3. **每人手牌**: 5张
4. **下注范围**: 1-10倍

### 牌型规则
| 牌型 | 说明 | 倍率 |
|------|------|------|
| 五小牛 | 5张总和≤10 | ×7 |
| 五花牛 | 全部JQK | ×6 |
| 炸弹 | 仅2种点数 | ×3 |
| 牛牛 | 3张成10倍数,剩余2张也是10倍数 | ×5 |
| 牛九 | 有牛且剩余2张之和为9 | ×4 |
| 牛八 | 有牛且剩余2张之和为8 | ×4 |
| ... | ... | ... |
| 牛一 | 有牛且剩余2张之和为1 | ×1 |
| 无牛 | 无法组成10的倍数 | ×1 |

### 胜负判定
1. 特殊牌型(炸弹、五小牛)>普通牛牌>无牛
2. 同等级比点数大小
3. 点数相同比最大单牌
4. 单牌相同比花色(黑桃>红桃>梅花>方块)

---

## 🏗️ 技术架构概览

### 前端架构
```
miniprogram/
├── pages/              # 页面组件
│   ├── index/          # 登录/主页
│   └── card_game/      # 游戏页
├── components/         # 可复用组件
│   ├── room-modal/     # 房间模态框
│   └── rules-modal/    # 规则模态框
├── api/                # API服务层
├── utils/              # 工具函数
│   ├── request.ts      # 请求封装
│   ├── mockData.ts     # Mock数据
│   ├── localStorage.ts # 本地存储
│   └── game.ts         # 游戏逻辑
├── typings/            # 类型定义
└── assets/             # 静态资源
```

### 技术栈
- **框架**: WeChat MiniProgram
- **组件框架**: Glass-Easel
- **语言**: TypeScript
- **样式**: LESS
- **状态管理**: 本地Storage + 页面Data
- **网络**: Axios (预留)

### 数据流
```
用户操作 → 页面事件 → API调用 → Mock/真实后端
                              ↓
                         响应数据
                              ↓
                    更新本地Storage/Data
                              ↓
                         UI重新渲染
```

---

## 📱 用户体验流程

### 新用户流程
```
打开小程序 → 微信登录授权 → 选择头像昵称 → 进入主页
    ↓
选择"快速开始"或"加入游戏"
    ↓
进入游戏房间 → 等待其他玩家/添加机器人
    ↓
准备并下注 → 庄家发牌 → 查看手牌 → 比牌结算
    ↓
继续下一局 或 退出房间
```

### 老用户流程
```
打开小程序 → 自动登录 → 主页
    ↓
继续之前的房间(如果有) 或 创建新房间
```

---

## 🎨 视觉设计概览

### 设计风格
- **主题**: 现代扁平化设计
- **色彩**: 渐变紫色系(#667eea → #764ba2)
- **动效**: 流畅的入场动画、悬浮效果
- **布局**: 横屏优化的卡牌游戏界面

### 核心色彩
- **主色**: 紫蓝渐变(#667eea, #764ba2)
- **辅助色**: 橙红(快速加入)、绿色(成功)、灰色(次要)
- **强调色**: 金色(高级牌型)、红色(错误/特殊牌型)

---

## 📈 项目指标

### 性能指标
- **首屏加载**: < 2秒
- **页面切换**: < 500ms
- **动画帧率**: 60fps
- **包大小**: < 2MB

### 用户体验指标
- **操作响应**: < 300ms
- **错误提示**: 即时显示
- **网络超时**: 10秒
- **断线重连**: 3次重试

---

## 🔐 安全与合规

### 数据安全
1. **用户隐私**: 仅收集必要信息(昵称、头像)
2. **数据加密**: HTTPS通信
3. **Token管理**: 安全存储在本地Storage
4. **敏感操作**: 需要用户确认

### 微信小程序规范
1. **内容合规**: 无赌博、无违法内容
2. **虚拟货币**: 使用积分而非真实货币
3. **用户协议**: 显示服务条款和隐私政策
4. **支付规范**: 如涉及支付需符合微信支付规范

---

## 📞 相关文档索引

请参阅以下分册文档获取详细信息:

1. **业务需求** → `项目需求文档-业务需求.md`
2. **功能需求** → `项目需求文档-功能需求.md`
3. **技术架构** → `项目需求文档-技术架构.md`
4. **数据模型** → `项目需求文档-数据模型.md`
5. **UI设计** → `项目需求文档-UI设计.md`
6. **开发计划** → `项目需求文档-开发计划.md`

---

## 📝 文档维护

### 更新记录
| 版本 | 日期 | 修改人 | 说明 |
|------|------|--------|------|
| v1.0 | 2025-12-29 | AI Assistant | 初始版本创建 |

### 文档约定
- **优先级标记**: P0(核心) > P1(重要) > P2(次要) > P3(优化)
- **状态标记**: ✅已完成 / ⚠️进行中 / ❌未开始 / 🔄待优化

---

**下一步**: 请查阅各分册文档了解详细需求规格。如需重构或添加新功能,请基于本文档进行需求评审和技术方案设计。
